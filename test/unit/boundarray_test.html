<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>JavaScript unit test file</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <script src="../assets/jsunittest.js" type="text/javascript"></script>
  
  <script src="../../src/boundarray.js" type="text/javascript"></script>
  
  <link rel="stylesheet" href="../assets/unittest.css" type="text/css" />
</head>
<body>

<div id="content">

  <div id="header">
    <h1>JavaScript unit test file</h1>
    <p>
      This file tests <strong>boundarray.js</strong>.
    </p>
  </div>

  <div id="array"></div>

	<div id="list"></div>

	<div id="methods"></div>
  
  <div id="testSandBox" style="display: none;">
  	<ul id="boundlist"></ul>
  </div>
</div>

<script type="text/javascript">
	var ba, element;

	// Array specific tests.
  new Test.Unit.Runner({
    setup: function () {
      ba = new BoundArray(['one', 'two', 'three'], null, null);
    },
    
    teardown: function () {
      
    },
    
    testGetters: function () {
      this.assertEqual('one', ba[0]);
			this.assertEqual('two', ba[1]);
			this.assertEqual('three', ba[2]);
    },

		testSetters: function () {
			this.assertEqual('one', ba[0]);
			this.assertEqual('two', ba[1]);
			this.assertEqual('three', ba[2]);
			ba[0] = '1';
			ba[1] = '2';
			ba[2] = '3';
			this.assertEqual('1', ba[0]);
			this.assertEqual('2', ba[1]);
			this.assertEqual('3', ba[2]);
		},

		testLength: function () {
			this.assertEqual(3, ba.length);
			ba[4] = 'three'; // Shouldn't work.
			this.assertEqual(3, ba.length);

			ba.length = 5;
			this.assertEqual(5, ba.length);
			this.assertEqual(null, ba[3]);
			this.assertEqual(null, ba[4]);
		},
		
		testGrowth: function () {
			ba.length = 5;
			this.assertEqual(null, ba[4]);
			ba[4] = 'five';
			this.assertEqual('five', ba[4]);
		},

		testRegExp: function () {
			var re = /^(\d).*(\d)$/;
			var sult = re.exec('1 a b c 3');
			this.assertEqual(0, sult.index);
			this.assertEqual('1 a b c 3', sult.input)

			ba = new BoundArray(sult, null, null);
			this.assertEqual(0, ba.index);
			this.assertEqual('1 a b c 3', ba.input);
		},

		testMimicArray: function () {
			this.assert(ba);
			this.assertEqual('object', typeof ba);
			this.assertEqual('number', typeof ba.length);
			this.assertEqual('function', typeof ba.splice);
			this.assert(!ba.propertyIsEnumerable('length'));

			var is_array = function (value) {
				return value &&
					typeof value === 'object' &&
					typeof value.length === 'number' &&
					typeof value.splice === 'function' &&
					!(value.propertyIsEnumerable('length'));
			}

			this.assert(is_array(ba));
		},

		testInterceptors: function () {
			var result = ba.pop();
			this.assertEqual('three', result);
			ba.push('four');
			this.assertEqual('four', ba[2]);

			// TODO extend interception tests?
		}
      
  }, {testLog: "array"});

	// HTML list specific tests.
  new Test.Unit.Runner({
    setup: function () {
      ba = new BoundArray(['one', 'two', 'three'], 'boundlist', 'c');
			element = document.getElementById('boundlist');
    },
    
    teardown: function () {
      
    },

		testList: function () {			
			this.assertEqual('one', element.childNodes[0].innerHTML);
			this.assertEqual('two', element.childNodes[1].innerHTML);
			this.assertEqual('three', element.childNodes[2].innerHTML);
		},

		testSetters: function () {
			var second = element.childNodes[1];
			
			this.assertEqual('two', second.innerHTML);
			ba[1] = '2';
			this.assertEqual('2', second.innerHTML);
		},

		testClass: function () {
			var second = element.childNodes[1];
			this.assertEqual('c', second.getAttribute('class'));
		},

		testUndefined: function () {
			var last;

			ba.length = 5;
			last = document.getElementById('boundlist').childNodes[4];
			this.assertEqual('', last.innerHTML);
		}
      
  }, {testLog: "list"});

	// Method specific tests.
  new Test.Unit.Runner({
    setup: function () {
      ba = new BoundArray(['one', 'two', 'three'], 'boundlist', 'c');
			element = document.getElementById('boundlist');
    },
    
    teardown: function () {
      
    },

		testPop: function () {
			var result;

			this.assertEqual(3, element.childNodes.length);
			this.assertEqual(3, ba.length);
			result = ba.pop();
			this.assertEqual('three', result);
			this.assertEqual(2, element.childNodes.length);
			this.assertEqual(2, ba.length);
			result = ba.pop()
			this.assertEqual('two', result)
			this.assertEqual(1, element.childNodes.length);
			this.assertEqual(1, ba.length);
		},

		testPush: function () {
			var result;

			this.assertEqual(3, element.childNodes.length);
			result = ba.push('four');
			this.assertEqual(4, result);
			this.assertEqual(4, element.childNodes.length);
			this.assertEqual(4, ba.length);
			this.assertEqual('four', ba[3]);
			result = ba.push('five', 'six', 'seven');
			this.assertEqual(7, result);
			this.assertEqual(7, element.childNodes.length);
			this.assertEqual(7, ba.length);
			this.assertEqual('seven', ba[6]);
		},

		testReverse: function () {
			this.assertEqual(3, element.childNodes.length);
			this.assertEqual('three', element.childNodes[2].innerHTML);
			this.assertEqual('three', ba[2]);
			ba.reverse();
			this.assertEqual(3, element.childNodes.length);
			this.assertEqual('one', element.childNodes[2].innerHTML);
			this.assertEqual('one', ba[2]);
		}
      
  }, {testLog: "methods"});

</script>
</body>
</html>